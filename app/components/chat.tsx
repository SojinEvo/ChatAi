import React, { useEffect, useState, useRef, useCallback } from "react";

import AccountCircle from '@mui/icons-material/AccountCircle';
import ReactMarkdown from 'react-markdown';

import { Box, Stack, IconButton, SvgIcon } from '@mui/material';
import { styled } from '@mui/material/styles';
import StopCircleIcon from '@mui/icons-material/StopCircle';
import PauseCircleIcon from '@mui/icons-material/PauseCircle';
import PlayCircleIcon from '@mui/icons-material/PlayCircle';
import CachedIcon from '@mui/icons-material/Cached';

import { useReadChat } from "../hooks/chatHooks";

import type { ChatType } from "../ts/chat";

interface ChatProps {
    chat: ChatType[]; // 聊天内容
    chatStop: boolean; // 是否取消生成
    chatState: boolean; // 是否生成状态
    chatPause: boolean; // 是否暂停状态
    onCease: (readChat: string) => void; // 触发停止生成
    onReload: () => void; // 触发重新生成
    onPause: (pauseState: boolean) => void; // 触发暂停
    onChatState: (chatState: boolean) => void; // 触发聊天状态
}
const Chat = (props: ChatProps) => {
    const { chat, chatStop, chatState, chatPause, onCease, onReload, onPause, onChatState } = props;
    const boxShowRef = useRef(null);

    // 停止生成状态
    const [chatCease, setChatCease] = useState(false);

    // 间隙读字
    const { readChat } = useReadChat({ chat, chatStop, chatCease, chatState, chatPause });

    useEffect(() => {
        // 滚动条到最底部
        boxShowRef.current.scrollTop = boxShowRef.current.scrollHeight - boxShowRef.current.clientHeight;

        // 聊天开始
        if (chatState) {
            onPause(false);
        }
        // 聊天结束
        if (!chat[chat.length - 1].loading && chat[chat.length - 1].content.length === readChat.length) {
            onChatState(false);
        }
        return () => {
            setChatCease(false);
        }
    }, [chat, chatState, onChatState, onPause, readChat.length]);

    // 角色样式
    const Role = styled('h4')`
    font-family: ${({ theme }) => theme.typography.subtitle2};
    `;

    // 内容样式
    const Content = styled('span')`
    color: ${({ theme }) => theme.palette.text.secondary};
    font-family: ${({ theme }) => theme.typography.body2};
    `

    // 公共状态样式
    const publicStateStyle = {
        color: '#007bf3',
        width: 32,
        height: 32
    }

    // 停止生成样式
    const Cease = styled(StopCircleIcon)({
        ...publicStateStyle
    });

    // 重新生成样式
    const Reload = styled(CachedIcon)({
        ...publicStateStyle
    });

    // 暂停样式
    const Pause = styled(PauseCircleIcon)({
        ...publicStateStyle
    });

    // 继续样式
    const Resume = styled(PlayCircleIcon)({
        ...publicStateStyle
    });

    // 停止生成触发
    const cease = useCallback(() => {
        setChatCease(true);
        onPause(false);
        onCease(readChat);
    }, [onCease, onPause, readChat])

    // 重新生成触发
    const reload = useCallback(() => {
        onReload();
    }, [onReload])

    // 暂停生成触发
    const pause = useCallback(() => {
        onPause(true);
        onChatState(false);
    }, [onChatState, onPause])

    // 继续生成触发
    const resume = () => {
        onPause(false);
    }

    return (
        <Box className={'contentBox'} ref={boxShowRef} display="flex" flexDirection="column">
            <Box className={'viewBox'}>
                {
                    chat.map((item, index) => {
                        return (
                            <Stack key={index} direction="row" spacing={1}>
                                {
                                    item.role === 'ChatGPT' ?
                                        <SvgIcon id="gpt" className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                                            <path d="M855.823059 439.235765c10.059294-27.587765 12.589176-55.175529 10.059294-82.82353-2.529882-27.587765-12.528941-55.175529-25.118118-80.293647a216.907294 216.907294 0 0 0-92.822588-85.353412 196.487529 196.487529 0 0 0-125.530353-12.528941 263.951059 263.951059 0 0 0-67.764706-50.176c-25.057882-12.589176-55.175529-17.588706-82.823529-17.588706-42.646588 0-85.293176 12.528941-120.470588 37.647059-35.117176 25.118118-60.235294 60.235294-72.764236 100.412236-30.117647 7.529412-55.235765 20.058353-80.293647 35.117176-22.588235 17.588706-40.176941 40.176941-55.235764 62.765176-22.588235 37.647059-30.117647 80.293647-25.118118 122.940236 5.059765 42.706824 22.588235 82.823529 50.236235 115.471059a188.536471 188.536471 0 0 0-10.059294 82.823529c2.529882 27.587765 12.528941 55.235765 25.118118 80.293647a216.967529 216.967529 0 0 0 92.822588 85.353412 196.427294 196.427294 0 0 0 125.530353 12.528941c20.058353 20.118588 42.646588 37.647059 67.764706 50.236235 25.057882 12.528941 55.175529 17.528471 82.823529 17.528471 42.646588 0 85.293176-12.528941 120.470588-37.647059 35.117176-25.057882 60.235294-60.235294 72.764236-100.352a182.512941 182.512941 0 0 0 77.824-35.177412c22.588235-17.528471 42.646588-37.647059 55.175529-62.704941 22.588235-37.647059 30.117647-80.353882 25.118118-123.00047-4.999529-42.646588-20.058353-82.823529-47.706353-115.471059z m-301.176471 421.647059a146.070588 146.070588 0 0 1-97.882353-35.117177s2.529882-2.529882 5.059765-2.529882l160.587294-92.822589a19.636706 19.636706 0 0 0 10.059294-10.059294c2.529882-4.999529 2.529882-7.529412 2.529883-12.528941V481.882353l67.764705 40.116706v185.765647a147.937882 147.937882 0 0 1-148.118588 153.057882z m-323.764706-137.999059c-17.528471-30.117647-25.057882-65.295059-17.52847-100.412236 0 0 2.469647 2.529882 4.999529 2.529883l160.64753 92.822588A22.588235 22.588235 0 0 0 391.529412 720.414118c4.999529 0 10.059294 0 12.528941-2.529883l195.764706-112.941176v77.824L436.705882 778.059294a148.961882 148.961882 0 0 1-112.941176 15.058824 146.733176 146.733176 0 0 1-92.882824-70.234353z m-42.646588-348.882824c17.588706-30.117647 45.176471-52.705882 77.824-65.234823V499.471059c0 5.059765 0 10.059294 2.469647 12.589176a19.576471 19.576471 0 0 0 10.059294 9.999059l195.764706 112.941177-67.764706 40.176941-160.647529-92.882824c-35.117176-20.058353-60.235294-52.705882-70.234353-90.352941-10.059294-37.647059-7.529412-82.823529 12.528941-117.940706z m554.646588 128l-195.764706-112.941176 67.764706-40.176941 160.64753 92.882823c25.118118 15.058824 45.176471 35.117176 57.705412 60.235294 12.589176 25.118118 20.118588 52.705882 17.588705 82.82353A150.588235 150.588235 0 0 1 752.941176 712.824471V522.059294c0-4.999529 0-9.999059-2.529882-12.528941 0 0-2.469647-4.999529-7.529412-7.529412z m67.764706-100.412235s-2.469647-2.469647-4.999529-2.469647l-160.64753-92.882824c-4.999529-2.529882-7.529412-2.529882-12.528941-2.529882-4.999529 0-10.059294 0-12.528941 2.529882l-195.764706 112.941177V341.353412L587.294118 246.000941c25.118118-15.058824 52.705882-20.058353 82.823529-20.058353 27.587765 0 55.235765 9.999059 80.293647 27.587765 22.588235 17.588706 42.706824 40.176941 52.705882 65.234823 10.059294 25.118118 12.589176 55.235765 7.529412 82.82353z m-421.647059 140.589176l-67.764705-40.176941V313.765647c0-27.587765 7.529412-57.705412 22.588235-80.293647 15.058824-25.118118 37.647059-42.706824 62.765176-55.235765 25.118118-12.528941 55.235765-17.588706 82.82353-12.528941 27.587765 2.469647 55.235765 15.058824 77.824 32.587294 0 0-2.529882 2.529882-5.059765 2.529883L401.588706 293.707294A19.576471 19.576471 0 0 0 391.529412 303.706353c-2.529882 5.059765-2.529882 7.529412-2.529883 12.589176V542.117647z m35.177412-80.353882L512 411.648l87.823059 50.176v100.412235L512 612.412235l-87.823059-50.176V461.824z" p-id="1600"></path>
                                        </SvgIcon>
                                        :
                                        <SvgIcon id="user" className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/">
                                            <path d="M401.706667 75.733333c68.053333-31.893333 150.293333-29.973333 219.306666-2.026666-36.693333-1.92-72.746667-10.56-109.44-11.946667-36.906667 2.24-73.066667 10.24-109.866666 13.973333z" fill="#86602E" opacity=".56" p-id="16457"></path><path d="M869.333333 58.773333c41.386667 2.026667 89.066667 18.56 104.96 60.48-1.493333 54.506667-66.24 60.693333-90.56 99.2-8.32-0.96-24.853333-2.666667-33.066666-3.626666-1.493333-1.493333-4.373333-4.48-5.866667-5.973334 9.813333-43.2 60.586667-46.506667 78.72-81.386666-7.573333-30.08-45.76-22.186667-69.12-24.213334 3.093333-15.36 8.106667-30.293333 14.933333-44.48z" fill="#1F1F1F" p-id="16458"></path><path d="M401.706667 75.733333c36.8-3.733333 72.96-11.733333 109.866666-13.973333 36.693333 1.386667 72.746667 10.026667 109.44 11.946667l15.893334 1.386666c-1.6 5.546667-5.013333 16.64-6.613334 22.186667l-3.093333 9.386667c-19.84-6.4-39.573333-13.44-59.413333-20.266667-2.56 12.053333-5.226667 24-8 35.946667l-1.813334 0.746666-3.2-35.093333c-9.386667 1.066667-18.666667 2.026667-28.053333 2.986667-98.453333-12.8-199.573333 24.533333-274.666667 87.68-10.453333-3.946667-20.8-7.786667-31.253333-11.626667 52.266667-43.306667 114.026667-77.546667 180.906667-91.306667zM876.053333 267.626667c2.666667-2.56 8-7.786667 10.666667-10.453334 63.04 95.786667 91.84 214.613333 72.32 328.213334-21.653333 143.68-118.506667 273.173333-249.493333 335.466666-95.253333 45.013333-207.573333 67.84-309.44 31.68-133.12-34.24-248.96-131.093333-302.826667-257.92-37.653333-91.306667-60.373333-197.333333-22.293333-292.266666a576 576 0 0 0 17.493333 62.4c-33.706667 173.44 72.96 354.133333 227.84 431.146666 135.04 68.16 306.133333 57.28 431.36-27.52 81.386667-57.6 147.626667-140.906667 170.453333-239.36 9.386667-31.36 15.04-63.786667 16-96.533333 1.6-53.546667-3.626667-107.84-22.08-158.293333-14.08-37.546667-26.773333-82.986667-69.44-96.32 12.48 3.733333 22.293333 0.32 29.44-10.24z" fill="#F0AC53" p-id="16459"></path><path d="M252.053333 178.666667c75.093333-63.146667 176.213333-100.48 274.666667-87.68-32.746667 9.493333-67.413333 20.053333-90.346667 47.146666-12.266667 15.36-34.773333 29.866667-28.586666 52.48 6.293333 9.493333 14.826667 12.373333 25.6 8.533334 20.373333-14.933333 35.733333-35.733333 56.533333-50.133334 21.546667-11.413333 45.546667-17.066667 68.053333-25.92l1.813334-0.746666c2.773333-11.946667 5.44-23.893333 8-35.946667 19.84 6.826667 39.573333 13.866667 59.413333 20.266667l7.36 2.133333c14.933333 8.106667 50.986667 1.386667 44.586667 26.56-18.666667 17.173333-40.106667 31.253333-58.986667 48.32-75.626667-20.8-164.373333 25.813333-182.613333 103.68-23.68 82.133333 42.346667 172.48 126.506666 178.773333 77.333333 7.893333 156.16-55.786667 156.373334-135.36 5.333333-55.36-28.16-103.36-68.053334-137.92 32.533333-16.213333 79.253333-38.613333 64.853334-83.52 19.626667 11.946667 39.04 24 57.92 37.12-14.08 15.36-54.613333 45.76-18.666667 58.773334 18.453333-10.453333 35.946667-22.506667 54.506667-32.96 11.2 12.266667 22.506667 24.426667 33.813333 36.586666 1.493333 1.493333 4.373333 4.48 5.866667 5.973334 3.946667 4.48 11.946667 13.226667 16 17.706666l-24.426667-1.706666c-4.48 6.826667-13.546667 20.373333-18.133333 27.093333l22.506666 19.946667c42.666667 13.333333 55.36 58.773333 69.44 96.32 18.453333 50.453333 23.68 104.746667 22.08 158.293333-10.346667 17.6-23.04 34.453333-41.28 44.373333-67.946667 37.866667-143.573333 65.6-222.4 64.426667-2.133333 13.226667-4.373333 26.56-6.506666 39.893333-5.866667-18.666667-11.626667-37.44-17.493334-56.106666-4.8-13.333333-9.6-43.946667-30.933333-32.106667-34.133333 17.92-64.853333 42.026667-100.906667 56.32 0.96-4.053333 2.986667-12.266667 3.946667-16.32 24.213333-18.773333 51.626667-33.386667 75.626667-52.48-26.346667-5.76-53.866667-10.026667-77.653334-23.68-52.16-27.2-84.373333-78.826667-131.093333-113.28-8.746667 3.84-17.493333 7.68-26.24 11.306667l-3.52-8.213334c-1.493333-33.6 3.093333-67.84-3.626667-101.013333-22.08-51.626667-74.133333-93.12-131.84-93.013333-37.546667-1.6-70.826667 17.813333-103.68 33.386666 13.546667-19.733333 25.066667-41.493333 43.52-57.173333 44.586667-26.24 90.773333-2.88 134.933334 9.706667 28.693333-34.986667-21.333333-51.093333-46.933334-59.84m469.333334 43.946666c2.986667 7.68 9.066667 23.146667 12.053333 30.826667 10.773333-4.906667 35.84 1.813333 31.253333-18.24 5.653333-26.88-28.8-27.52-43.306666-12.586667z" fill="#FDEC78" p-id="16460"></path><path d="M526.72 90.986667c9.386667-0.96 18.666667-1.92 28.053333-2.986667l3.2 35.093333c-22.506667 8.853333-46.506667 14.506667-68.053333 25.92-20.8 14.4-36.16 35.2-56.533333 50.133334-10.773333 3.84-19.306667 0.96-25.6-8.533334-6.186667-22.613333 16.32-37.12 28.586666-52.48 22.933333-27.093333 57.6-37.653333 90.346667-47.146666z" fill="#A43D0D" p-id="16461"></path><path d="M636.586667 78.826667c29.226667 2.133333 60.693333 6.506667 80.64 30.506666 14.4 44.906667-32.32 67.306667-64.853334 83.52 39.893333 34.56 73.386667 82.56 68.053334 137.92-0.213333 79.573333-79.04 143.253333-156.373334 135.36-84.16-6.293333-150.186667-96.64-126.506666-178.773333 18.24-77.866667 106.986667-124.48 182.613333-103.68 18.88-17.066667 40.32-31.146667 58.986667-48.32 6.4-25.173333-29.653333-18.453333-44.586667-26.56l-7.36-2.133333 3.093333-9.386667c1.6-4.586667 4.693333-13.866667 6.293334-18.453333M444.693333 297.066667c-7.573333 62.293333 28.8 127.893333 88.746667 149.44 81.6 31.466667 182.613333-38.08 176.96-126.826667 1.92-46.933333-30.506667-83.946667-61.12-115.306667-0.853333 16-2.133333 31.893333-3.946667 47.68-22.186667 2.24-40.213333-8.746667-36.8-33.386666 13.333333-3.84 26.773333-8.106667 39.36-14.293334-33.28-9.813333-69.12-24.533333-103.68-10.453333-50.026667 12.48-83.093333 56.64-99.52 103.146667z" fill="#18191D" p-id="16462"></path><path d="M741.013333 111.466667c4.586667-49.28 69.44-30.08 88-1.6 15.04 22.186667-2.986667 46.186667-18.026666 62.4-18.56 10.453333-36.053333 22.506667-54.506667 32.96-35.946667-13.013333 4.586667-43.413333 18.666667-58.773334 6.4 0 12.693333 0 19.093333-0.106666 0.426667-6.4 1.066667-19.306667 1.493333-25.813334-17.92-4.8-36.266667-7.466667-54.72-9.066666zM721.386667 222.613333c14.506667-14.933333 48.96-14.293333 43.306666 12.586667 4.586667 20.053333-20.48 13.333333-31.253333 18.24-2.986667-7.68-9.066667-23.146667-12.053333-30.826667z" fill="#16181D" p-id="16463"></path><path d="M130.666667 214.186667c1.28-45.866667 60.48-31.893333 90.133333-47.146667 10.453333 3.84 20.8 7.68 31.253333 11.626667 25.6 8.746667 75.626667 24.853333 46.933334 59.84-44.16-12.586667-90.346667-35.946667-134.933334-9.706667-8.32-3.626667-24.96-10.986667-33.386666-14.613333z" fill="#A33D0D" p-id="16464"></path><path d="M444.693333 297.066667c16.426667-46.506667 49.493333-90.666667 99.52-103.146667 34.56-14.08 70.4 0.64 103.68 10.453333-12.586667 6.186667-26.026667 10.453333-39.36 14.293334-3.413333 24.64 14.613333 35.626667 36.8 33.386666 1.813333-15.786667 3.093333-31.68 3.946667-47.68 30.613333 31.36 63.04 68.373333 61.12 115.306667 5.653333 88.746667-95.36 158.293333-176.96 126.826667-59.946667-21.546667-96.32-87.146667-88.746667-149.44m138.56 8.32c-3.093333 6.4-9.28 19.2-12.266666 25.6 10.346667 26.453333 48.533333 40.106667 64.64 10.88 10.026667-22.506667-8.96-38.72-26.346667-48.746667-6.506667 3.093333-19.52 9.173333-26.026667 12.266667zM184.213333 270.826667c42.453333-18.773333 91.733333-0.106667 125.226667 28.053333 66.666667 57.173333 52.053333 181.973333-31.04 216.64C202.453333 557.546667 98.453333 501.333333 90.026667 415.68c-11.946667-64 33.173333-127.253333 94.186666-144.853333m56.533334 108.053333c-29.866667 26.346667 18.453333 72.426667 44.053333 43.52 32.32-26.56-17.6-78.506667-44.053333-43.52z" fill="#FFFFFF" p-id="16465"></path><path d="M824.106667 257.92c4.586667-6.72 13.653333-20.266667 18.133333-27.093333l24.426667 1.706666 11.413333 0.96c-0.533333 8.533333-1.6 25.6-2.026667 34.133334-7.146667 10.56-16.96 13.973333-29.44 10.24l-22.506666-19.946667z" fill="#1E1E1F" p-id="16466"></path><path d="M120.533333 285.973333c32.853333-15.573333 66.133333-34.986667 103.68-33.386666 57.706667-0.106667 109.76 41.386667 131.84 93.013333 6.72 33.173333 2.133333 67.413333 3.626667 101.013333-28.906667 69.226667-106.453333 106.88-179.2 92.053334-35.306667-16.533333-68.906667-38.826667-88-73.92a576 576 0 0 1-17.493333-62.4c1.386667-43.093333 23.253333-80.96 45.546666-116.373334m63.68-15.146666c-61.013333 17.6-106.133333 80.853333-94.186666 144.853333 8.426667 85.653333 112.426667 141.866667 188.373333 99.84 83.093333-34.666667 97.706667-159.466667 31.04-216.64-33.493333-28.16-82.773333-46.826667-125.226667-28.053333zM583.253333 305.386667c6.506667-3.093333 19.52-9.173333 26.026667-12.266667 17.386667 10.026667 36.373333 26.24 26.346667 48.746667-16.106667 29.226667-54.293333 15.573333-64.64-10.88 2.986667-6.4 9.173333-19.2 12.266666-25.6z" fill="#1D1D1D" p-id="16467"></path><path d="M240.746667 378.88c26.453333-34.986667 76.373333 16.96 44.053333 43.52-25.6 28.906667-73.92-17.173333-44.053333-43.52z" fill="#191919" p-id="16468"></path><path d="M389.44 443.52c46.72 34.453333 78.933333 86.08 131.093333 113.28 23.786667 13.653333 51.306667 17.92 77.653334 23.68-24 19.093333-51.413333 33.706667-75.626667 52.48-0.96 4.053333-2.986667 12.266667-3.946667 16.32-55.36 25.706667-116.373333 34.56-176.746666 37.973333-21.973333-2.453333-26.133333 22.506667-26.133334 39.04-4.693333 1.493333-14.08 4.373333-18.773333 5.76 4.8-21.333333 11.413333-42.24 19.84-62.506666-22.293333-18.133333-45.76-36.906667-56.533333-64.426667-13.546667-34.453333-51.84-46.506667-79.786667-66.453333 72.746667 14.826667 150.293333-22.826667 179.2-92.053334l3.52 8.213334c8.746667-3.626667 17.493333-7.466667 26.24-11.306667z" fill="#FEDA75" p-id="16469"></path><path d="M320.32 895.893333C165.44 818.88 58.773333 638.186667 92.48 464.746667c19.093333 35.093333 52.693333 57.386667 88 73.92 27.946667 19.946667 66.24 32 79.786667 66.453333 10.773333 27.52 34.24 46.293333 56.533333 64.426667-8.426667 20.266667-15.04 41.173333-19.84 62.506666 4.693333-1.386667 14.08-4.266667 18.773333-5.76 30.826667 35.52 67.52 69.333333 114.453334 80.853334 43.84-0.32 86.293333-12.693333 127.36-27.2 17.173333 4.693333 35.2 6.72 52.48 1.173333 62.72-16.533333 129.066667-25.173333 185.28-59.52 46.933333-24.32 84.8-61.44 126.826666-92.586667-22.826667 98.453333-89.066667 181.76-170.453333 239.36-125.226667 84.8-296.32 95.68-431.36 27.52z" fill="#FFCA73" p-id="16470"></path><path d="M896.853333 576.853333c18.24-9.92 30.933333-26.773333 41.28-44.373333-0.96 32.746667-6.613333 65.173333-16 96.533333-42.026667 31.146667-79.893333 68.266667-126.826666 92.586667-56.213333 34.346667-122.56 42.986667-185.28 59.52-17.28 5.546667-35.306667 3.52-52.48-1.173333l29.013333-13.226667c18.346667-9.813333 34.986667-22.613333 49.813333-37.226667 13.333333-33.173333 13.973333-69.226667 14.08-104.426666 5.866667 18.666667 11.626667 37.44 17.493334 56.106666 2.133333-13.333333 4.373333-26.666667 6.506666-39.893333 78.826667 1.173333 154.453333-26.56 222.4-64.426667z" fill="#FED875" p-id="16471"></path><path d="M518.613333 649.28c36.053333-14.293333 66.773333-38.4 100.906667-56.32 21.333333-11.84 26.133333 18.773333 30.933333 32.106667-0.106667 35.2-0.746667 71.253333-14.08 104.426666-26.24-10.773333-53.013333-27.2-82.56-21.76-39.04 5.866667-73.6 27.413333-103.573333 52.053334-7.786667 15.253333-13.76 31.36-20.053333 47.36-46.933333-11.52-83.626667-45.333333-114.453334-80.853334 0-16.533333 4.16-41.493333 26.133334-39.04 60.373333-3.413333 121.386667-12.266667 176.746666-37.973333z" fill="#7D180F" p-id="16472"></path><path d="M450.24 759.786667c29.973333-24.64 64.533333-46.186667 103.573333-52.053334 29.546667-5.44 56.32 10.986667 82.56 21.76-14.826667 14.613333-31.466667 27.413333-49.813333 37.226667-42.133333-24.746667-90.773333-6.933333-136.32-6.933333z" fill="#EB6D5A" p-id="16473"></path><path d="M430.186667 807.146667c6.293333-16 12.266667-32.106667 20.053333-47.36 45.546667 0 94.186667-17.813333 136.32 6.933333l-29.013333 13.226667c-41.066667 14.506667-83.52 26.88-127.36 27.2z" fill="#E24F1F" p-id="16474"></path>
                                        </SvgIcon>
                                }
                                <Stack spacing={1}>
                                    <Role>{item.role}</Role>
                                    <Content><ReactMarkdown>{item.role === 'ChatGPT' && index === chat.length - 1 ? readChat : item.content}</ReactMarkdown></Content>
                                    {
                                        index === chat.length - 1 && readChat.length > 0 && !chat[chat.length - 1].loading ?
                                            readChat.length !== chat[chat.length - 1].content.length || chatPause ?
                                                <Stack direction="row" spacing={1}>
                                                    <span style={{ color: "#0057A3" }}>
                                                        停止生成
                                                        <IconButton id={'case'} aria-label={'case'} onClick={cease}>
                                                            <Cease />
                                                        </IconButton>
                                                    </span>
                                                    {
                                                        chatPause ?
                                                            <span style={{ color: "#0057A3" }}>继续生成
                                                                <IconButton id={'resume'} aria-label={'resume'} onClick={resume}>
                                                                    <Resume />
                                                                </IconButton>
                                                            </span> : <span style={{ color: "#0057A3" }}>暂停生成
                                                                <IconButton id={'pause'} aria-label={'pause'} onClick={pause}>
                                                                    <Pause />
                                                                </IconButton>
                                                            </span>
                                                    }

                                                </Stack>
                                                : <span style={{ color: "#0057A3" }}>
                                                    重新生成
                                                    <IconButton id={'reload'} aria-label={'reload'} onClick={reload}>
                                                        <Reload />
                                                    </IconButton>
                                                </span>
                                            : null
                                    }
                                </Stack>
                            </Stack>
                        )
                    })
                }
            </Box >
        </Box >
    )
};

export default React.memo(Chat);